-title "Question Report"
%p{:style => 'font-size:140%'}
  ="\"#{@question.name}\""
%p
  -if @question.range?
    ="Range question, 1 to #{@question.range}"
  -else
    -for answer in @question.answers
      ="#{answer.name}. #{answer.text}"
%p
  -bardata = @question.bardata
  -total_answers = @question.responses.count
  -categories = @question.chart_categories
  -piedata = @question.piedata
%p
  %table
    %tr
      %td
        #piechart{:style => 'width: 400px; height: 500px;'}
      %td
        #barchart{:style => 'width: 600px; height: 500px;'}
  
  :javascript
    function create_barchart() {
      new Highcharts.Chart({
         chart: {
            renderTo: 'barchart',
            defaultSeriesType: 'column',
            margin: [ 50, 50, 100, 80]
         },
         title: {
            text: 'Respondents by Answer'
         },
         xAxis: {
            categories: #{categories},
            labels: {
               rotation: -45,
               align: 'right',
               style: {
                   font: 'normal 13px Verdana, sans-serif'
               }
            }
         },
         yAxis: {
            min: 0,
            title: {
               text: 'Respondents'
            }
         },
         legend: {
            enabled: false
         },
         tooltip: {
            formatter: function() {
               return '<b>'+ this.x +'</b><br/>'+
                   Highcharts.numberFormat(this.y, 1);
            }
         },
         plotOptions: {
           column: {
           }
         },
         series: [{
            name: 'Respondents',
            data: #{bardata},
            dataLabels: {
               enabled: true,
               rotation: -90,
               color: '#FFFFFF',
               align: 'right',
               x: -3,
               y: 10,
               formatter: function() {
                  return this.y + " respondents";
               },
               style: {
                  font: 'normal 13px Verdana, sans-serif'
               }
            }         
         }]
      });    
    }
    
    function create_piechart() {
      new Highcharts.Chart({  
        chart: { renderTo: 'piechart' },
        title: { text: 'Most Popular Responses' },
        tooltip: {
           formatter: function() {
              return '<b>'+ this.point.name +'</b>('+ this.y +' out of #{total_answers})  ';
           }
        },
        plotOptions: {
           pie: {
              allowPointSelect: true,
              cursor: 'pointer',
              dataLabels: {
                 enabled: true,
                 formatter: function() {
                    return "Answer " + (this.point.x + 1);
                 },
                 color: 'white',
                 style: {
                    font: '13px Trebuchet MS, Verdana, sans-serif'
                 }
              }
           }
        },
        series: [{
          type: 'pie',
          name: 'Respondents',
          data: #{piedata}
        }]
      });
    }
    
    $(document).ready(function() {
      create_barchart();
      create_piechart();
    });


%p
  =link_to 'Back to Survey Report', show_survey_report_path(@question.survey)
